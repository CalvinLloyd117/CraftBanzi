{% set allCategories = craft.categories().group('pastMemberCategory').orderBy('dateCreated') %}
<h1 class="sectionTitle" id="Publications">Alumni</h1>

{% for category in allCategories %}
{% set sectionMembers = pastMembers.order('endYear').relatedTo(category).all %}
{# <p>{{category}}</p> #}
{% if sectionMembers %}
<section id="{{category.slug}}">
    <div class="sectionBannerText">
        <h1>{{category}}</h1>
    </div>
    <div class="currentLabMembers">
        <div class="labMember">
            <div class="labMemberInfo labMemberList">
                <ul>
                    {% for labMember in sectionMembers | reverse %}
                    <li>
                        <h2>{{labMember.title}}</h2>
                        {% if labMember.startYear and labMember.endYear and labMember.educationAchieved.first %}
                        <p>{{labMember.educationAchieved.first}} ({{labMember.startYear}} - {{labMember.endYear}})</p>
                        {% if labMember.whoAreThey %}
                        <p>{{labMember.whoAreThey}}</p>
                        {% endif %}
                        {% elseif labMember.endYear and labMember.educationAchieved.first %}
                        <p>{{labMember.educationAchieved.first}} ({{labMember.endYear}})</p>
                        {% if labMember.whoAreThey %}
                        <p>{{labMember.whoAreThey}}</p>
                        {% endif %}
                        {% elseif labMember.whoAreThey and labMember.startYear and labMember.endYear %}
                        <p>{{labMember.whoAreThey}} ({{labMember.startYear}} - {{labMember.endYear}})</p>
                        {% elseif labMember.whoAreThey and labMember.endYear %}
                        <p>{{labMember.whoAreThey}} ({{labMember.endYear}})</p>
                        {% elseif labMember.startYear and labMember.endYear %}
                        <p>{{labMember.startYear}} - {{labMember.endYear}}</p>
                        {% elseif labMember.endYear %}
                        <p>{{labMember.endYear}}</p>
                        {% endif %}
                        {% if labMember.now %}
                        <p><b>Now:</b> {{labMember.now}}</p>
                        {% endif %}

                        {% if (labMember.isFieldEmpty("labMemberDepartment") == false) and
                        labMember.isFieldEmpty('university') == false %}
                        <p>{{labMember.labMemberDepartment.one.title}}, {{labMember.university.one.title}}</p>
                        {% elseif (labMember.isFieldEmpty("labMemberDepartment")) and
                        labMember.isFieldEmpty('university') == false %}
                        <p>{{labMember.university.one.title}}</p>
                        {% elseif (labMember.isFieldEmpty("labMemberDepartment") == false) and
                        labMember.isFieldEmpty('university') %}
                        {{labMember.labMemberDepartment.one.title}}
                        {% endif %}

                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</section>
{% endif %}
{% endfor %}